language: go

go:
  - '1.10.1'

addons:
  apt:
    packages:
      - curl
      - p7zip-full

install:
  # Install dep
  - curl https://raw.githubusercontent.com/golang/dep/master/install.sh | sh
  # Intall project dependencies using dep
  - dep ensure -v
  # Install gox cross compile tool
  - go get github.com/mitchellh/gox
  # Install Node.js and NPM (reequired by snyk)
  - curl -sL https://deb.nodesource.com/setup_8.x | sudo -E bash -
  - sudo apt-get install -y nodejs
  # Install snky
  - sudo npm install -g snyk

script:
  - .travis/build.sh
  - snyk test

after_success:
  - bash <(curl -s https://codecov.io/bash)
  - snyk monitor --org=gantsign --project-name=alt-galaxy

branches:
  only:
    - master
    - /^(0|[1-9][0-9]*)\.(0|[1-9][0-9]*)([\.\-].*)?$/

deploy:
  provider: releases
  api_key:
    secure: F/Sj5uG2HTFKsAt1Ns4SYOlapXnFC8Y+1lErvup3JVtc1qZ0tAW4xD5konSQBtMD6S06z12mZbSlGqUMnBq885RdJQKgg7H15p/che5o56jNDTZ3cncH93Ows6WRmor8LWXq1oq39i+N+edTdb4DCO+YBwGj9e1oFT1yXbZXmB6dUvH1JiVbdNJYoF7Qr360Tbv34nlt1EKtGtKFcusdbn++OtzkTJIpP6bYFng5w4YD5P345xOWuwmrG67LdzNlN9TVfFhuDvwDzeEtQOc62JAJkxt8SvKIbT3YFbZDzkPelkJTt02zVpUyRvpMvojkM54Vx20rzApAf94sQ9fa3VE5M98cwErsu7MacKU+Z0cJvIovIQmmRnWELmbRyhxnC9VFG1yzXXQJzBuv01mkDp79cOMzXFAMbl/poNlOzr0w0DoJzYGUgsFTX2Y47rm0nLcGkScxafW3waQY5gJhjpDGLF8O8Nv9nldHYrl1pYByGdCZr2r6SiEvbKi21a8oiG1U9z/xUmNqxvbr0DqisVzrrBEb4UzC18YeJv/MKrwhNsMkh8XkYBu4P+Q5jLx7WLVmOLdgrj0oADQa/YmrvOUrD2FZI89Wb2ydZF+CdkNs3ksf3a3l4ShvDouBk0tn2bCci8IbcuczNnj9G3I2uY09gx9z1LoGjtdNXfLkP2o=
  file:
    - dist/alt-galaxy_linux_386.tar.xz
    - dist/alt-galaxy_linux_amd64.tar.xz
    - dist/alt-galaxy_darwin_amd64.tar.gz
    - dist/alt-galaxy_windows_386.7z
    - dist/alt-galaxy_windows_amd64.7z
  skip_cleanup: true
  on:
    repo: gantsign/alt-galaxy
    tags: true

env:
  global:
    - OS_TARGETS="linux darwin windows"
    - ARCH_TARGETS="386 amd64"
    # snky token
    - secure: 0q1S1KMgq+i63sFmiEjqwICZ/nfjlpKVb535uGIqwcVXqlT7yW/If6vOw7YsijWoLP50RMeIy6Ur8ecPwXT04BjaO8h+Z3f9mAVlsB44EeUrkGc9yFkaQZvDeMyTWtLnPka3CDC2OKSsZzSu/mn6I1iyxZmOo/Divpql8Imi3I5RxQDae3kMP0maeUArYq54um3fFsiZm4u5RNojnPNojFP/e9pNFHMa1gyV1YrpvxGMUDQezoPq3gcalnc84/g4xKkn521SdaKj5Qz0i2Kvf7gUAUPg9uxR/s1FNKwdM7bPrvkdyg9APGEsdHwIbpOyVAD2J7hinhN1ahSqWnLz/DtxAyNsAXdXyFVwDP6fXQCB25coODDRRfsZkGu8veLelraFLhrLCY0gM1vn+ecNZD9EhtRJCvqEcKSZk17dbT76EwIDc+VJAE8kbfYnt3VK1LR1MSX/+b7AeLXvUaN1QJmOfECwbI0ZDsQd3WBMcgGjz7BQ3RZysv7Zh7vgtOBfOY7gXTzlOIKovevkaJODAEFOQgJomFnKnkBXooLaF2HJ7GjLD3J9VkowshP4nAmS4n07E5Y08o4g7UamJryGC0yyuEp4NphV+uKFhNFdbaKDgF1dOncWAGv7sI6H06y8u7pgNsLGF8GyqRPaKrOPuwTNuhbAqdsbTNfS5l8CwJM=
